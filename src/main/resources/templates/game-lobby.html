<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:insert="fragments/header :: head">
    <title>Game lobby</title>
</head>

<body>
<nav th:replace="fragments/menu :: menu-bar"></nav>

<br><br><br><br>
<div class="container block-normal">
    <div class="container block-in">
        <h3 style="text-align: center;">ONLINE LOBBY</h3>
        <br/>
        <h3 id="availableGames">Available games:</h3>
        <table class="lobby" id="gamesTable" th:object="${games}">
            <thead>
            <tr class="games">
                <th class="id-col">Game id</th>
                <th class="games">Player1</th>
                <th class="games">Player2</th>
                <th class="joinButton"></th>
            </tr>
            </thead>
            <tbody id = "gamesTableBody">
            <tr class="games" th:each="row : ${games}">
                <td class="id-col" th:text="${row.getId()}"></td>
                <td class="games" th:text="${row.player1}==null ? 'waiting for player' : ${row.player1.getUsername()}"></td>
                <td class="games" th:text="${row.player2}==null ? 'waiting for player' : ${row.player2.getUsername()}"></td>
                <td class="joinButton"><input type="button" class="bold" value="Join" th:onclick="|window.location.href='/joinGame?gameId=${row.getId()}'|"></td>
            </tr>
            </tbody>
        </table>
        <br>
        <button id="createNewGame" type="button" class="bold" th:object="${createdGame}" onclick="createNewGame()" th:style="${createdGame} == null ? 'visibility:visible' : 'visibility:hidden'">Create new game</button>
        <button id="send" type="button" class="bold" th:object="${createdGame}" onclick="usun()" th:style="${createdGame} == null ? 'visibility:visible' : 'visibility:hidden'">send</button>
        <button id="disconnect" type="button" class="bold" th:object="${createdGame}" onclick="disconnect()" th:style="${createdGame} == null ? 'visibility:visible' : 'visibility:hidden'">disconnect</button>
    </div>

    <div class="container block-right">

        <table class="users-online" id="users-online" th:object="${loggedUsers}" align="right">
            <thead>
                <tr>
                    <th class="games">Users online:</th>
                </tr>
            </thead>
            <tbody id="users-online-tbody">
            <tr><td></td></tr>
            </tbody>
        </table>

        <br>

        <table class="chat-table" align="right">
        <tbody class="chat-body"><tr><td>
            <form id = "chatForm" name = "chatForm">
            <textarea name = "chatOutput" id = "chatOutput" rows="10" cols="40" readonly align="right" form="chatForm">
            </textarea>
            <textarea id = "chatInput" name = "chatInput" rows="2" cols="40" align="right" form="chatForm">
            </textarea>
            </form>
        </td></tr></tbody>
        </table>
    </div>
</div>

<div class="container">
    <p>
        Welcome <span id="currentUsername" sec:authentication="principal.username">User</span>
    </p>
</div>

<script type="text/javascript" th:src="@{/webjars/jquery/3.6.0/jquery.min.js/}"></script>
<script type="text/javascript" th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.js" integrity="sha512-lyIq9fRcCeSCXhp41XC/250UBmypAHV8KW+AhLcSEIksWHBfhzub6XXwDe67wTpOG8zrO2NAU/TYmEaCW+aQSg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js" integrity="sha512-iKDtgDyTHjAitUDdLljGhenhPwrbBfqTKWO1mkhSFH3A7blITC9MhYon6SjnMhp4o0rADGw9yAC6EW4t5a4K3g==" crossorigin="anonymous"></script>
<script src="webSocketGameLobby.js" type="text/javascript"></script>
<script src="logoutTimeout.js" type="text/javascript"></script>
<script th:inline="javascript">

</script>
</body>
</html>