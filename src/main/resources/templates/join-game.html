<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:insert="fragments/header :: head">
    <title>Join game</title>
</head>

<body>
<nav th:replace="fragments/menu :: menu-bar"></nav>

<br>
<br>
<br>
<br>

<div class="container">
    <h3 id="availableGames">Available games:</h3>
    <table id="gamesTable" th:object="${games}">
        <thead>
        <tr class="games">
            <th class="id-col">Game id</th>
            <th class="games">Player1</th>
            <th class="games">Player2</th>
            <th class="joinButton"></th>
        </tr>
        </thead>
        <tbody>
        <tr class="games" th:each="row : ${games}">
            <td class="id-col" th:text="${row.getId()}"></td>
            <td class="games" th:text="${row.player1}==null ? 'waiting for player' : ${row.player1.getUsername()}"></td>
            <td class="games" th:text="${row.player2}==null ? 'waiting for player' : ${row.player2.getUsername()}"></td>
            <td class="joinButton"><input type="button" class="bold" value="Join" th:onclick="|window.location.href='/joinGame?gameId=${row.getId()}'|"></td>
        </tr>
        </tbody>
    </table>
</div>

<div class="container">
    <p>
        Welcome <span sec:authentication="principal.username">User</span>
    </p>
</div>

<script type="text/javascript" th:src="@{/webjars/jquery/3.6.0/jquery.min.js/}"></script>
<script type="text/javascript" th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
<script th:inline="javascript">

    var games = [[${games}]];
    window.onload = function() {
    var that = document.getElementById("gamesTable");
        if(!games)
            that.style.visibility = "hidden";
        that.style.visibility = "visible";
    };

</script>
</body>
</html>